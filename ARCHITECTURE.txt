# Guild Boss Timer - Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         GUILD BOSS TIMER SYSTEM                         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                            CLIENT LAYER                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │
│  │   Web Browser    │  │   Mobile Safari  │  │   Edge/Chrome    │    │
│  │                  │  │                  │  │                  │    │
│  │  http://localhost│  │  Responsive UI   │  │  Dark Mode       │    │
│  │       :3000      │  │                  │  │                  │    │
│  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘    │
│           │                     │                     │               │
│           └─────────────────────┴─────────────────────┘               │
│                                 │                                     │
└─────────────────────────────────┼─────────────────────────────────────┘
                                  │
                                  │ HTTPS / REST API
                                  │
┌─────────────────────────────────▼─────────────────────────────────────┐
│                         FRONTEND LAYER                                │
│                      Next.js 14 + TypeScript                          │
│                        Deployed on Vercel                             │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                      PAGES (App Router)                       │   │
│  ├──────────────────────────────────────────────────────────────┤   │
│  │                                                               │   │
│  │  ┌────────────────┐              ┌─────────────────┐        │   │
│  │  │  Boss List     │              │  Calendar View  │        │   │
│  │  │  (/)           │◄────────────►│  (/calendar)    │        │   │
│  │  │                │              │                 │        │   │
│  │  │ • Live Timers  │              │ • FullCalendar  │        │   │
│  │  │ • Filters      │              │ • Month/Week    │        │   │
│  │  │ • Edit/Kill    │              │ • Color Events  │        │   │
│  │  └────────────────┘              └─────────────────┘        │   │
│  │                                                               │   │
│  └───────────────────────────────┬───────────────────────────────┘   │
│                                  │                                   │
│  ┌───────────────────────────────▼───────────────────────────────┐   │
│  │                       COMPONENTS                               │   │
│  ├────────────────────────────────────────────────────────────────┤   │
│  │                                                                │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐   │   │
│  │  │  LiveTimer   │  │ PasswordModal│  │  EditBossModal   │   │   │
│  │  │              │  │              │  │                  │   │   │
│  │  │ • Countdown  │  │ • Auth       │  │ • Edit Times     │   │   │
│  │  │ • Colors     │  │ • Validation │  │ • Auto-Calc      │   │   │
│  │  │ • Updates    │  │              │  │                  │   │   │
│  │  └──────────────┘  └──────────────┘  └──────────────────┘   │   │
│  │                                                                │   │
│  └────────────────────────────────┬───────────────────────────────┘   │
│                                   │                                   │
│  ┌────────────────────────────────▼──────────────────────────────┐   │
│  │                         API CLIENT                             │   │
│  ├────────────────────────────────────────────────────────────────┤   │
│  │  • getAllBosses()                                              │   │
│  │  • updateBoss(id, password, updates)                           │   │
│  │  • killBoss(id, password)                                      │   │
│  │  • checkPassword(password)                                     │   │
│  └────────────────────────────────┬───────────────────────────────┘   │
│                                   │                                   │
└───────────────────────────────────┼───────────────────────────────────┘
                                    │
                                    │ HTTP/JSON
                                    │ port 3001
                                    │
┌───────────────────────────────────▼───────────────────────────────────┐
│                          BACKEND LAYER                                │
│                    Node.js + Express + TypeScript                     │
│                         Deployed on Render                            │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                      REST API ROUTES                          │   │
│  ├──────────────────────────────────────────────────────────────┤   │
│  │                                                               │   │
│  │  GET    /health               → Health Check                 │   │
│  │  GET    /api/bosses           → Get All Bosses               │   │
│  │  GET    /api/bosses/:id       → Get Single Boss              │   │
│  │  POST   /api/auth/check       → Validate Password            │   │
│  │  POST   /api/bosses/:id/update → Update Boss Times           │   │
│  │  POST   /api/bosses/:id/kill  → Mark Boss as Killed          │   │
│  │                                                               │   │
│  └───────────────────────────────┬───────────────────────────────┘   │
│                                  │                                   │
│  ┌───────────────────────────────▼───────────────────────────────┐   │
│  │                       MIDDLEWARE                               │   │
│  ├────────────────────────────────────────────────────────────────┤   │
│  │                                                                │   │
│  │  • express.json()      → Parse JSON bodies                    │   │
│  │  • cors()              → Cross-Origin Resource Sharing        │   │
│  │  • helmet()            → Security Headers                     │   │
│  │                                                                │   │
│  └────────────────────────────────┬───────────────────────────────┘   │
│                                   │                                   │
│  ┌────────────────────────────────▼──────────────────────────────┐   │
│  │                      BUSINESS LOGIC                            │   │
│  ├────────────────────────────────────────────────────────────────┤   │
│  │                                                                │   │
│  │  • Password Validation (bcrypt hash comparison)               │   │
│  │  • Auto-Calculate Next Spawn (now + respawnHours)             │   │
│  │  • Boss CRUD Operations                                        │   │
│  │  • Error Handling                                              │   │
│  │                                                                │   │
│  └────────────────────────────────┬───────────────────────────────┘   │
│                                   │                                   │
│  ┌────────────────────────────────▼──────────────────────────────┐   │
│  │                    DATABASE CONNECTION                         │   │
│  ├────────────────────────────────────────────────────────────────┤   │
│  │                                                                │   │
│  │  • Connection Pool (pg)                                        │   │
│  │  • Parameterized Queries                                       │   │
│  │  • SSL Support                                                 │   │
│  │                                                                │   │
│  └────────────────────────────────┬───────────────────────────────┘   │
│                                   │                                   │
└───────────────────────────────────┼───────────────────────────────────┘
                                    │
                                    │ PostgreSQL Protocol
                                    │ SSL/TLS
                                    │
┌───────────────────────────────────▼───────────────────────────────────┐
│                         DATABASE LAYER                                │
│                      PostgreSQL (Aiven Database)                      │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                          TABLES                               │   │
│  ├──────────────────────────────────────────────────────────────┤   │
│  │                                                               │   │
│  │  ┌────────────────────────────────────────────────────┐     │   │
│  │  │              BOSSES TABLE                          │     │   │
│  │  ├────────────────────────────────────────────────────┤     │   │
│  │  │ • id              SERIAL PRIMARY KEY               │     │   │
│  │  │ • name            VARCHAR(255)                     │     │   │
│  │  │ • attack_type     VARCHAR(50)                      │     │   │
│  │  │ • level           INTEGER                          │     │   │
│  │  │ • respawn_hours   INTEGER                          │     │   │
│  │  │ • location        VARCHAR(255)                     │     │   │
│  │  │ • last_kill_at    TIMESTAMP WITH TIME ZONE         │     │   │
│  │  │ • next_spawn_at   TIMESTAMP WITH TIME ZONE         │     │   │
│  │  │ • is_scheduled    BOOLEAN                          │     │   │
│  │  │ • created_at      TIMESTAMP WITH TIME ZONE         │     │   │
│  │  │ • updated_at      TIMESTAMP WITH TIME ZONE         │     │   │
│  │  └────────────────────────────────────────────────────┘     │   │
│  │                                                               │   │
│  │  ┌────────────────────────────────────────────────────┐     │   │
│  │  │             SETTINGS TABLE                         │     │   │
│  │  ├────────────────────────────────────────────────────┤     │   │
│  │  │ • id              SERIAL PRIMARY KEY               │     │   │
│  │  │ • key             VARCHAR(255) UNIQUE              │     │   │
│  │  │ • value           TEXT                             │     │   │
│  │  │ • created_at      TIMESTAMP WITH TIME ZONE         │     │   │
│  │  │ • updated_at      TIMESTAMP WITH TIME ZONE         │     │   │
│  │  └────────────────────────────────────────────────────┘     │   │
│  │                                                               │   │
│  └───────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                          INDEXES                              │   │
│  ├──────────────────────────────────────────────────────────────┤   │
│  │                                                               │   │
│  │  • PRIMARY KEY on bosses.id                                  │   │
│  │  • PRIMARY KEY on settings.id                                │   │
│  │  • UNIQUE INDEX on settings.key                              │   │
│  │  • (Optional) INDEX on bosses.next_spawn_at                  │   │
│  │  • (Optional) INDEX on bosses.location                       │   │
│  │                                                               │   │
│  └───────────────────────────────────────────────────────────────┘   │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘


┌───────────────────────────────────────────────────────────────────────┐
│                          DATA FLOW EXAMPLES                           │
└───────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────┐
│  1. USER VIEWS BOSS LIST                                             │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Browser ──GET /──► Next.js Server Component                         │
│              │                                                        │
│              └──GET /api/bosses──► Express API                       │
│                      │                                                │
│                      └──SELECT * FROM bosses──► PostgreSQL            │
│                                  │                                    │
│  Browser ◄──JSON──◄ Next.js ◄──JSON──◄ Express ◄──Rows──◄ PostgreSQL│
│     │                                                                 │
│     └──LiveTimer updates every 1 second                              │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────┐
│  2. USER MARKS BOSS AS KILLED                                        │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Browser ──[Kill Button]──► PasswordModal                            │
│                  │                                                    │
│                  └──User enters "naiwan"                              │
│                       │                                               │
│  Browser ──POST /api/bosses/:id/kill { password: "naiwan" }──► API   │
│                           │                                           │
│                           ├──Validate Password (bcrypt.compare)       │
│                           │                                           │
│                           ├──Calculate next spawn:                    │
│                           │  nextSpawn = now + respawnHours          │
│                           │                                           │
│                           └──UPDATE bosses SET                        │
│                              last_kill_at = now,                      │
│                              next_spawn_at = nextSpawn──► PostgreSQL  │
│                                       │                               │
│  Browser ◄──Updated Boss──◄ API ◄────┘                               │
│     │                                                                 │
│     └──LiveTimer starts countdown                                    │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────┐
│  3. USER EDITS BOSS TIMES                                            │
├───────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Browser ──[Edit Button]──► PasswordModal                            │
│                  │                                                    │
│                  └──User enters "naiwan"                              │
│                       │                                               │
│  Browser ─────────────┴──► EditBossModal                             │
│                  │                                                    │
│                  └──User modifies times                               │
│                       │                                               │
│  Browser ──POST /api/bosses/:id/update {                             │
│              password: "naiwan",                                      │
│              updates: { nextSpawnAt: "2024-01-01T12:00:00Z" }        │
│            }──► API                                                   │
│                  │                                                    │
│                  ├──Validate Password                                 │
│                  │                                                    │
│                  └──UPDATE bosses SET                                 │
│                     next_spawn_at = '2024-01-01T12:00:00Z'──► DB     │
│                              │                                        │
│  Browser ◄──Updated Boss──◄─┘                                        │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘


┌───────────────────────────────────────────────────────────────────────┐
│                      DEPLOYMENT TOPOLOGY                              │
└───────────────────────────────────────────────────────────────────────┘

                        Internet Users
                              │
                              │ HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         Vercel CDN                                  │
│                    (Frontend Hosting)                               │
│                                                                     │
│  • Next.js Static Files                                            │
│  • Server-Side Rendering                                           │
│  • Global Distribution                                             │
│  • Automatic HTTPS                                                 │
│                                                                     │
└────────────────────────┬────────────────────────────────────────────┘
                         │
                         │ API Calls (HTTPS)
                         │
┌────────────────────────▼────────────────────────────────────────────┐
│                      Render Web Service                             │
│                     (Backend Hosting)                               │
│                                                                     │
│  • Node.js Runtime                                                 │
│  • Express API                                                     │
│  • Auto-scaling                                                    │
│  • Health Checks                                                   │
│  • Automatic HTTPS                                                 │
│                                                                     │
└────────────────────────┬────────────────────────────────────────────┘
                         │
                         │ PostgreSQL Protocol (SSL)
                         │
┌────────────────────────▼────────────────────────────────────────────┐
│                    Aiven PostgreSQL                                 │
│                    (Database Hosting)                               │
│                                                                     │
│  • Managed PostgreSQL                                              │
│  • Automatic Backups                                               │
│  • High Availability                                               │
│  • SSL Encryption                                                  │
│  • Monitoring                                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘


Legend:
───► Data Flow
◄─── Response Flow
├──  Subprocess
└──  Final Step
▼    Direction
